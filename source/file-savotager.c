#include "../header/const.h"
#include "../header/file-savotager.h"

char ** filter_file_by_prefix(const char * path, const char * prefix) {
    int prefix_len = strlen(prefix);
    char ** ret;
    DIR * curr_dir;
    struct dirent * dirp;
    if ((curr_dir = opendir(path)) == NULL)
        return NULL;
    while((dirp = readdir(curr_dir)) != NULL) {
        if(strncmp(prefix, dirp->d_name, prefix_len) == 0) {
            printf("%s\n", dirp->d_name);
        }
    }
    closedir(curr_dir);
}

char ** get_file_list(const char * path) {
    int ent_cnt = 0;
    int str_len;
    char ** file_arr = malloc(sizeof(char *) * MAX_ENTRY_CNT + 1);
    DIR * dir;
    struct dirent * dirp;

    if ((dir = opendir(path)) == NULL) return NULL;
    while((dirp = readdir(dir)) != NULL) {
        if (strcmp(dirp->d_name, ".") == 0 || strcmp(dirp->d_name, "..") == 0) continue;
        str_len = strlen(dirp->d_name);
        file_arr[ent_cnt++] = (char *) malloc(sizeof(char) * (str_len + 1));
        memset(file_arr[ent_cnt - 1], '\0', str_len + 1);
        strcpy(file_arr[ent_cnt - 1], dirp->d_name);
    }
    file_arr[ent_cnt] = NULL;
    closedir(dir);
    return file_arr;
}